---
import Layout from '../layouts/Layout.astro';
import CartService from '../services/CartService.ts';
---

<Layout 
  title="Test Cart - Avadhuta Tech" 
  description="Test the cart functionality and see how items are managed"
>
  <div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold text-gray-900 mb-8">Cart Testing Page</h1>
    
    <!-- Cart Status Display -->
    <div class="bg-white rounded-lg shadow-lg p-6">
      <h2 class="text-xl font-bold text-gray-900 mb-4">Current Cart Status</h2>
      <div id="cart-status">
        <p class="text-gray-600">Loading cart status...</p>
      </div>
    </div>

    <!-- Test Controls -->
    <div class="mt-8 bg-white rounded-lg shadow-lg p-6">
      <h2 class="text-xl font-bold text-gray-900 mb-4">Test Results</h2>
      <div id="test-results" class="text-gray-600">
        <p>Test results will appear here...</p>
      </div>
      
      <div class="mt-6 space-y-4">
        <button 
          onclick="testAddPod()" 
          class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors"
        >
          Test Add Pod
        </button>
        
        <button 
          onclick="testAddPack()" 
          class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition-colors ml-4"
        >
          Test Add Pack
        </button>
        
        <button 
          onclick="testRemoveItem()" 
          class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition-colors ml-4"
        >
          Test Remove Item
        </button>
        
        <button 
          onclick="testClearCart()" 
          class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700 transition-colors ml-4"
        >
          Test Clear Cart
        </button>
      </div>
    </div>
  </div>
</Layout>

<script>
  import CartService from '../services/CartService.ts';
  
  // Initialize cart service
  const cartService = new CartService();
  
  // Test functions
  function testAddPod() {
    const testPod = {
      id: 'test-pod-' + Date.now(),
      name: 'Test Pod',
      price: 999,
      type: 'pod'
    };
    
    cartService.addItem(testPod);
    updateCartStatus();
    logTestResult('Added test pod: ' + testPod.name);
  }
  
  function testAddPack() {
    const testPack = {
      id: 'test-pack-' + Date.now(),
      name: 'Test Pack',
      price: 299,
      type: 'pack'
    };
    
    cartService.addItem(testPack);
    updateCartStatus();
    logTestResult('Added test pack: ' + testPack.name);
  }
  
  function testRemoveItem() {
    const items = cartService.getItems();
    if (items.length > 0) {
      const itemToRemove = items[0];
      cartService.removeItem(itemToRemove.id);
      updateCartStatus();
      logTestResult('Removed item: ' + itemToRemove.name);
    } else {
      logTestResult('No items to remove');
    }
  }
  
  function testClearCart() {
    cartService.clearCart();
    updateCartStatus();
    logTestResult('Cleared cart');
  }
  
  function updateCartStatus() {
    const statusDiv = document.getElementById('cart-status');
    const items = cartService.getItems();
    const total = cartService.getTotal();
    
    statusDiv.innerHTML = `
      <p class="text-gray-600">Items in cart: ${items.length}</p>
      <p class="text-gray-600">Total: $${total}</p>
      <div class="mt-4">
        <h3 class="font-semibold text-gray-900 mb-2">Cart Items:</h3>
        ${items.map((item: any) => `
          <div class="bg-gray-50 p-2 rounded mb-2">
            <p class="text-sm text-gray-700">${item.name} - $${item.price} (${item.type})</p>
          </div>
        `).join('')}
      </div>
    `;
  }
  
  function logTestResult(message: string) {
    const resultsDiv = document.getElementById('test-results');
    const timestamp = new Date().toLocaleTimeString();
    resultsDiv.innerHTML += `<p class="text-sm text-gray-500">[${timestamp}] ${message}</p>`;
  }
  
  // Initialize display
  document.addEventListener('DOMContentLoaded', () => {
    updateCartStatus();
  });
</script> 