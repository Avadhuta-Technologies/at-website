---
import { generateSlug } from '../../utils/slugUtils.js';

// Case Study Card Component
export interface Props {
  caseStudy: {
    id: string;
    title: string;
    industry: string;
    duration: string;
    problemStatement: string;
    techStack: string[];
    impact: string[];
    badge: string;
    badgeColor: string;
  };
  index: number;
}

const { caseStudy, index } = Astro.props;

// Color mapping for different case study types - using brand colors only
const getColorClasses = (badgeColor: string) => {
  const colors = {
    blue: {
      bg: 'bg-cerulean-50/80',
      border: 'border-cerulean-200/50',
      text: 'text-cerulean-700',
      badge: 'bg-cerulean-100/90 text-cerulean-800 backdrop-blur-sm',
      iconBg: 'bg-cerulean-100/80',
      gradient: 'from-cerulean-500 to-cerulean-600'
    },
    green: {
      bg: 'bg-mint-50/80',
      border: 'border-mint-200/50',
      text: 'text-mint-700',
      badge: 'bg-mint-100/90 text-mint-800 backdrop-blur-sm',
      iconBg: 'bg-mint-100/80',
      gradient: 'from-mint-500 to-mint-600'
    },
    purple: {
      bg: 'bg-graphite-50/80',
      border: 'border-graphite-200/50',
      text: 'text-graphite-700',
      badge: 'bg-graphite-100/90 text-graphite-800 backdrop-blur-sm',
      iconBg: 'bg-graphite-100/80',
      gradient: 'from-graphite-500 to-graphite-600'
    },
    indigo: {
      bg: 'bg-cerulean-50/80',
      border: 'border-cerulean-200/50',
      text: 'text-cerulean-700',
      badge: 'bg-cerulean-100/90 text-cerulean-800 backdrop-blur-sm',
      iconBg: 'bg-cerulean-100/80',
      gradient: 'from-cerulean-500 to-cerulean-600'
    },
    teal: {
      bg: 'bg-mint-50/80',
      border: 'border-mint-200/50',
      text: 'text-mint-700',
      badge: 'bg-mint-100/90 text-mint-800 backdrop-blur-sm',
      iconBg: 'bg-mint-100/80',
      gradient: 'from-mint-500 to-mint-600'
    },
    orange: {
      bg: 'bg-graphite-50/80',
      border: 'border-graphite-200/50',
      text: 'text-graphite-700',
      badge: 'bg-graphite-100/90 text-graphite-800 backdrop-blur-sm',
      iconBg: 'bg-graphite-100/80',
      gradient: 'from-graphite-500 to-graphite-600'
    },
    pink: {
      bg: 'bg-mint-50/80',
      border: 'border-mint-200/50',
      text: 'text-mint-700',
      badge: 'bg-mint-100/90 text-mint-800 backdrop-blur-sm',
      iconBg: 'bg-mint-100/80',
      gradient: 'from-mint-500 to-mint-600'
    }
  };
  return colors[badgeColor as keyof typeof colors] || colors.blue;
};

// Generate contextual icon based on case study
const getCaseStudyIcon = (caseStudy: any) => {
  const title = caseStudy.title.toLowerCase();
  const industry = caseStudy.industry.toLowerCase();
  const badge = caseStudy.badge.toLowerCase();
  
  // AI/ML related
  if (title.includes('ai') || title.includes('ml') || badge.includes('ai') || badge.includes('ml')) {
    return '🤖';
  }
  
  // Ecommerce
  if (title.includes('ecommerce') || industry.includes('ecommerce') || badge.includes('ecommerce')) {
    return '🛒';
  }
  
  // Mobile App
  if (title.includes('app') || badge.includes('mobile')) {
    return '📱';
  }
  
  // Design/3D
  if (title.includes('design') || title.includes('3d') || badge.includes('design')) {
    return '🎨';
  }
  
  // Security
  if (title.includes('security') || badge.includes('security')) {
    return '🔐';
  }
  
  // Automation
  if (title.includes('automation') || badge.includes('automation')) {
    return '⚙️';
  }
  
  // Marketplace
  if (title.includes('marketplace') || badge.includes('marketplace')) {
    return '🏪';
  }
  
  // SaaS
  if (badge.includes('saas')) {
    return '☁️';
  }
  
  return '🚀';
};

const colors = getColorClasses(caseStudy.badgeColor);
const icon = getCaseStudyIcon(caseStudy);
---

<a href={`/case-studies/${generateSlug(caseStudy.title)}`} class="case-study-card group relative overflow-hidden rounded-xl transition-all duration-300 hover:scale-105 hover:-translate-y-1 cursor-pointer block">
  <!-- Card Background - Solid color instead of gradient (matching brand guidelines) -->
  <div class="absolute inset-0 bg-white/90 backdrop-blur-sm border border-white/30 rounded-xl shadow-sm group-hover:shadow-xl transition-all duration-300"></div>
  
  <!-- Card Content -->
  <div class="relative p-6 flex flex-col h-full">
    <!-- Card Header -->
    <div class="flex items-start justify-between mb-4">
      <div class={`w-14 h-14 ${colors.iconBg} rounded-xl flex items-center justify-center backdrop-blur-sm group-hover:scale-110 transition-transform duration-300`}>
        <span class="text-2xl">{icon}</span>
      </div>
      <span class={`inline-flex items-center px-3 py-1 rounded-full text-xs font-inter font-semibold ${colors.badge} border border-current/20`}>
        {caseStudy.badge}
      </span>
    </div>
    
    <!-- Title and Industry -->
    <h3 class="text-xl font-inter font-bold text-graphite-900 mb-2 group-hover:text-graphite-800 transition-colors duration-200">
      {caseStudy.title}
    </h3>
    
    <p class="text-sm font-inter text-graphite-500 mb-4">
      {caseStudy.industry} • {caseStudy.duration}
    </p>
    
    <!-- Problem Statement (truncated) -->
    <div class="flex-1 mb-6">
      <p class="text-graphite-600 font-inter leading-relaxed text-sm case-study-description">
        {caseStudy.problemStatement.length > 120 
          ? caseStudy.problemStatement.substring(0, 120) + '...' 
          : caseStudy.problemStatement}
      </p>
    </div>
    
    <!-- Tech Stack -->
    <div class="mb-4">
      <h4 class="text-sm font-inter font-semibold text-graphite-700 mb-2 flex items-center">
        <svg class="w-4 h-4 mr-2 text-cerulean-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
        </svg>
        Tech Stack
      </h4>
      <div class="flex flex-wrap gap-2">
        {caseStudy.techStack.slice(0, 3).map((tech) => (
          <span class="px-2 py-1 bg-graphite-100/80 text-graphite-700 text-xs font-inter rounded-md backdrop-blur-sm">
            {tech}
          </span>
        ))}
        {caseStudy.techStack.length > 3 && (
          <span class="px-2 py-1 bg-graphite-100/80 text-graphite-700 text-xs font-inter rounded-md backdrop-blur-sm">
            +{caseStudy.techStack.length - 3} more
          </span>
        )}
      </div>
    </div>
    
    <!-- Impact -->
    <div class="mb-6">
      <h4 class="text-sm font-inter font-semibold text-graphite-700 mb-2 flex items-center">
        <svg class="w-4 h-4 mr-2 text-mint-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
        </svg>
        Impact
      </h4>
      <ul class="space-y-1">
        {caseStudy.impact.slice(0, 2).map((impact) => (
          <li class="flex items-start text-xs font-inter text-graphite-600">
            <svg class="w-3 h-3 text-mint-500 mr-2 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            {impact}
          </li>
        ))}
      </ul>
    </div>
    
    <!-- View Details Button -->
    <div class="w-full inline-flex items-center justify-center px-4 py-3   text-graphite-700 font-inter font-normal ">
      <svg class="w-4 h-4 mr-2 group-hover:translate-x-1 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
      </svg>
      <span class="font-inter font-normal text-sm">View Details</span>
    </div>
  </div>
</a>

<style>
  /* Case Study Card Animations */
  .case-study-card {
    opacity: 1 !important;
    transform: translateY(0) !important;
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    display: block !important;
  }

  .case-study-card.animate {
    opacity: 1;
    transform: translateY(0);
  }

  /* Hover Effects */
  .case-study-card:hover {
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
  }

  /* Text truncation */
  .case-study-description {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .case-study-card {
      padding: 1.5rem;
    }
  }
</style> 