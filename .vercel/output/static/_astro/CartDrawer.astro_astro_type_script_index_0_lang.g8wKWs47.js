class p{constructor(){this.isOpen=!1,this.isMinimized=!1,this.init()}async init(){this.setupEventListeners(),this.loadCart(),window.addEventListener("cart-updated",()=>{this.loadCart()})}setupEventListeners(){document.getElementById("close-cart")?.addEventListener("click",()=>{this.close()}),document.getElementById("minimize-cart")?.addEventListener("click",()=>{this.toggleMinimize()}),document.getElementById("checkout-btn")?.addEventListener("click",()=>{window.location.href="/checkout"}),document.addEventListener("click",t=>{const n=document.getElementById("cart-drawer");t.target===n&&this.close()}),document.addEventListener("keydown",t=>{t.key==="Escape"&&this.isOpen&&this.close()})}async loadCart(){try{const t=this.getCartFromLocalStorage();this.renderCart(t)}catch(t){console.error("Error loading cart:",t),this.showEmpty()}}getCartFromLocalStorage(){try{const t=localStorage.getItem("novapod-cart");return t?JSON.parse(t):[]}catch(t){return console.error("Error reading localStorage:",t),[]}}renderCart(t){const n=document.getElementById("cart-loading"),a=document.getElementById("cart-empty"),r=document.getElementById("cart-items"),i=document.getElementById("cart-total-items"),e=document.getElementById("checkout-btn");if(t.length===0){n?.classList.add("hidden"),a?.classList.remove("hidden"),r?.classList.add("hidden"),i&&(i.textContent="0"),e&&(e.disabled=!0,e.textContent="Cart is Empty");return}n?.classList.add("hidden"),a?.classList.add("hidden"),r?.classList.remove("hidden");const l=t.filter(o=>o.type==="pod"),d=t.filter(o=>o.type==="pack");let s="";l.length>0&&(s+='<div class="mb-6">',s+='<h4 class="text-sm font-semibold text-gray-700 mb-3">Pod</h4>',l.forEach(o=>{s+=this.renderCartItem(o)}),s+="</div>"),d.length>0&&(s+='<div class="border-t border-gray-200 pt-4 mt-4">',s+='<h4 class="text-sm font-semibold text-gray-700 mb-3">Packs</h4>',d.forEach(o=>{s+=this.renderCartItem(o)}),s+="</div>"),r&&(r.innerHTML=s),i&&(i.textContent=t.length.toString()),e&&(e.disabled=!1,e.textContent="Continue to Checkout"),this.addRemoveListeners()}renderCartItem(t){const n=t.type==="pod"?"blue":"green";return`
        <div class="cart-item bg-white rounded-lg border border-gray-200 p-4" data-item-id="${t.id}" data-item-type="${t.type}">
          <div class="flex items-start justify-between">
            <div class="flex-1">
              <div class="flex items-center mb-2">
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-${n}-100 text-${n}-800 mr-2">
                  ${t.type==="pod"?"Pod":"Pack"}
                </span>
                <h4 class="text-sm font-semibold text-gray-900">${t.title}</h4>
              </div>
              <p class="text-xs text-gray-600 mb-2 line-clamp-2">${t.description}</p>
              <span class="text-sm font-medium text-gray-900">${t.price}</span>
            </div>
            <button 
              class="remove-item-btn ml-2 p-1 text-gray-400 hover:text-red-500 transition-colors"
              title="Remove item"
            >
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>
        </div>
      `}addRemoveListeners(){document.addEventListener("click",async t=>{const a=t.target.closest(".remove-item-btn");if(a){t.preventDefault();const r=a.closest(".cart-item");if(r){const i=r.getAttribute("data-item-id"),e=r.getAttribute("data-item-type");if(i&&e){const l=localStorage.getItem("novapod-cart");if(l){const d=JSON.parse(l),s=d.find(c=>c.id===i&&c.type===e),o=s?.title||s?.name||"Item";if(window.removeItemConfirmationModal)window.removeItemConfirmationModal.show(o,e,()=>{const c=d.filter(m=>!(m.id===i&&m.type===e));localStorage.setItem("novapod-cart",JSON.stringify(c)),window.dispatchEvent(new CustomEvent("cart-updated"))},()=>{console.log("Cart item removal cancelled")});else{const c=d.filter(m=>!(m.id===i&&m.type===e));localStorage.setItem("novapod-cart",JSON.stringify(c)),window.dispatchEvent(new CustomEvent("cart-updated"))}}}}}})}showEmpty(){const t=document.getElementById("cart-loading"),n=document.getElementById("cart-empty"),a=document.getElementById("cart-items");t?.classList.add("hidden"),n?.classList.remove("hidden"),a?.classList.add("hidden")}open(){const t=document.getElementById("cart-drawer");t&&(t.classList.remove("translate-x-full"),this.isOpen=!0,document.body.style.overflow="hidden")}close(){const t=document.getElementById("cart-drawer");t&&(t.classList.add("translate-x-full"),this.isOpen=!1,document.body.style.overflow="")}toggleMinimize(){const t=document.getElementById("cart-drawer");t&&(this.isMinimized?(t.classList.remove("w-16"),t.classList.add("w-80")):(t.classList.remove("w-80"),t.classList.add("w-16")),this.isMinimized=!this.isMinimized)}}typeof window<"u"&&(window.cartDrawer=new p);window.openCartDrawer=function(){window.cartDrawer&&window.cartDrawer.open()};
